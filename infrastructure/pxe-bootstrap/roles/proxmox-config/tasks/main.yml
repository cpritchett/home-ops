---
- name: Generate Proxmox boot profiles
  template:
    src: "proxmox-profile.json.j2"
    dest: "/mnt/{{ truenas_pool }}/{{ truenas_apps_dataset }}/data/profiles/proxmox.json"
    mode: "0644"
  delegate_to: localhost
  become: no

- name: Generate Proxmox groups
  template:
    src: "proxmox-groups.json.j2"
    dest: "/mnt/{{ truenas_pool }}/{{ truenas_apps_dataset }}/data/groups/proxmox.json"
    mode: "0644"
  delegate_to: localhost
  become: no

- name: Generate Proxmox firstboot scripts
  template:
    src: "proxmox-firstboot.sh.j2"
    dest: "/mnt/{{ truenas_pool }}/{{ truenas_apps_dataset }}/configs/proxmox-{{ item }}.sh"
    mode: "0755"
  loop: "{{ groups['proxmox_nodes'] }}"
  delegate_to: localhost
  become: no

- name: Create Proxmox answer files
  template:
    src: "proxmox-answer.txt.j2"
    dest: "/mnt/{{ truenas_pool }}/{{ truenas_apps_dataset }}/configs/proxmox-{{ item }}-answer.txt"
    mode: "0644"
  loop: "{{ groups['proxmox_nodes'] }}"
  delegate_to: localhost
  become: no
